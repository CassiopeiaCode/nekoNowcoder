# æ™ºä¹ƒçš„ç½—å¾·å²›åŸºå»º - é¢˜è§£

### æ ‡ç­¾ä¸éš¾åº¦
> **æ ‡ç­¾**: æ•°å­¦, æ•°è®º, æ•´é™¤åˆ†å—, å‰ç¼€å’Œ, å…¬å¼æ¨å¯¼
> **éš¾åº¦**: 2200

## é¢˜ç›®å¤§æ„å–µ~

Mya~ha~lo~! ä¸»äººï¼Œæ¬¢è¿æ¥åˆ°ç½—å¾·å²›ï¼Œæˆ‘æ˜¯ä½ çš„å‘å¯¼çŒ«å¨˜å“¦ï¼è¿™æ¬¡æˆ‘ä»¬è¦å¸®åŠ©å¯çˆ±çš„æ™ºä¹ƒé…±è®¡ç®—å¥¹åœ¨ç½—å¾·å²›åŸºå»ºçš„æ€»æ”¶ç›Šï¼Œå–µ~

äº‹æƒ…æ˜¯è¿™æ ·çš„ï¼š
æ™ºä¹ƒæœ‰ $M$ ä¸ªè´¸æ˜“ç«™ï¼Œç¼–å·ä» $1$ åˆ° $M$ã€‚åœ¨ $N$ å¤©çš„æ—¶é—´é‡Œï¼Œè¿™äº›è´¸æ˜“ç«™ä¼šä¸æ–­ç”Ÿäº§é¾™é—¨å¸ã€‚

æ¯ä¸ªè´¸æ˜“ç«™ $i$ æœ‰ä¸¤ä¸ªå±æ€§ï¼šç­‰çº§ $L_i$ å’Œè´¸æ˜“ç‚¹æ•° $P_i$ã€‚ä¸€å¼€å§‹ï¼Œæ‰€æœ‰ç«™ç‚¹çš„ $L_i$ å’Œ $P_i$ éƒ½æ˜¯ $0$ã€‚

æ¯å¤©ï¼ˆæ¯”å¦‚ç¬¬ $y$ å¤©ï¼‰ä¼šå‘ç”Ÿä¸¤ä»¶äº‹ï¼š
1.  **ç‚¹æ•°å¢åŠ **ï¼šå¯¹äºæ‰€æœ‰èƒ½æ•´é™¤ $y$ çš„è´¸æ˜“ç«™ç¼–å· $d$ (ä¸” $d \le M$)ï¼Œå®ƒçš„è´¸æ˜“ç‚¹æ•° $P_d$ å¢åŠ  1ã€‚
2.  **å‡çº§ä¸ç”Ÿäº§**ï¼š
    *   ç‚¹æ•°å¢åŠ åï¼Œæ¯ä¸ªè´¸æ˜“ç«™ä¼šæ£€æŸ¥è‡ªå·±æ˜¯å¦å¯ä»¥å‡çº§ã€‚ä¸€ä¸ªç­‰çº§ä¸º $x$ çš„è´¸æ˜“ç«™ï¼Œå¦‚æœå®ƒçš„ç‚¹æ•° $P_i \ge x+1$ï¼Œå®ƒå°±ä¼šæ¶ˆè€— $x+1$ ç‚¹æ•°ï¼Œç­‰çº§æå‡åˆ° $x+1$ã€‚è¿™ä¸ªè¿‡ç¨‹å¯èƒ½ä¼šè¿ç»­å‘ç”Ÿå¤šæ¬¡ï¼Œç›´åˆ°ç‚¹æ•°ä¸è¶³ä»¥å‡çº§ä¸ºæ­¢ã€‚
    *   å‡çº§å…¨éƒ¨å®Œæˆåï¼Œæ¯ä¸ªè´¸æ˜“ç«™ $i$ ä¼šç”Ÿäº§ $A \cdot L_i^2 + B \cdot P_i + C$ çš„é¾™é—¨å¸ã€‚

æˆ‘ä»¬çš„ä»»åŠ¡å°±æ˜¯ï¼Œè®¡ç®—ä»ç¬¬ 1 å¤©åˆ°ç¬¬ $N$ å¤©ï¼Œæ‰€æœ‰è´¸æ˜“ç«™ç”Ÿäº§çš„é¾™é—¨å¸æ€»å’Œæ˜¯å¤šå°‘ï¼Œç»“æœéœ€è¦å¯¹ $10^9 + 9$ å–æ¨¡ï¼Œå‘ã€‚

## è§£é¢˜æ€è·¯åˆ†æ

è¿™é“é¢˜çœ‹èµ·æ¥æœ‰ç‚¹å¤æ‚ï¼Œæ¶‰åŠåˆ°æ¯å¤©çŠ¶æ€çš„å˜åŒ–ï¼Œå¦‚æœä¸€å¤©ä¸€å¤©åœ°æ¨¡æ‹Ÿï¼Œå½“ $N$ å’Œ $M$ éå¸¸å¤§çš„æ—¶å€™ï¼Œæˆ‘çš„å°è‚‰çƒé”®ç›˜å¯å°±æ•²ä¸è¿‡æ¥äº†å–µ~ ($O(N \cdot M \cdot \sqrt{N})$ çš„å¤æ‚åº¦ä¼šè¶…æ—¶)ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°ä¸€ä¸ªæ›´èªæ˜çš„æ•°å­¦æ–¹æ³•ï¼Œçš„è¯´ï¼

### å…³é”®æ´å¯Ÿï¼šè´¸æ˜“ç‚¹æ•°ä¸ç­‰çº§

é¦–å…ˆï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹è´¸æ˜“ç«™çš„çŠ¶æ€ã€‚ä¸€ä¸ªè´¸æ˜“ç«™ $i$ åœ¨ç¬¬ $y$ å¤©çš„çŠ¶æ€ï¼ˆç­‰çº§ $L_i$ å’Œç‚¹æ•° $P_i$ï¼‰åªå–å†³äºå®ƒåˆ°é‚£å¤©ä¸ºæ­¢**æ€»å…±è·å¾—äº†å¤šå°‘è´¸æ˜“ç‚¹æ•°**ã€‚

é‚£ä¹ˆï¼Œè´¸æ˜“ç«™ $i$ åœ¨ç¬¬ $y$ å¤©ç»“æŸæ—¶ï¼Œæ€»å…±è·å¾—äº†å¤šå°‘ç‚¹æ•°å‘¢ï¼Ÿ
æ ¹æ®è§„åˆ™ï¼Œå®ƒåœ¨ç¬¬ $k$ å¤©èƒ½è·å¾— 1 ç‚¹ï¼Œå½“ä¸”ä»…å½“ $i$ æ˜¯ $k$ çš„å› å­ã€‚æ‰€ä»¥ï¼Œåˆ°ç¬¬ $y$ å¤©ç»“æŸæ—¶ï¼Œå®ƒè·å¾—çš„æ€»ç‚¹æ•°å°±æ˜¯ $1$ åˆ° $y$ ä¹‹é—´ $i$ çš„å€æ•°çš„æ•°é‡ã€‚è¿™ä¸ªæ•°é‡æ­£å¥½æ˜¯ $\lfloor y/i \rfloor$ï¼

è®¾ä¸€ä¸ªè´¸æ˜“ç«™æ€»å…±è·å¾—äº† $T$ ä¸ªç‚¹æ•°ï¼Œå®ƒçš„ç­‰çº§ $L$ å’Œå½“å‰ç‚¹æ•° $P$ æ˜¯å¤šå°‘å‘¢ï¼Ÿ
*   ä» 0 çº§å‡åˆ° 1 çº§éœ€è¦ $1$ ç‚¹ã€‚
*   ä» 1 çº§å‡åˆ° 2 çº§éœ€è¦ $2$ ç‚¹ã€‚
*   ...
*   ä» $(k-1)$ çº§å‡åˆ° $k$ çº§éœ€è¦ $k$ ç‚¹ã€‚
è¦å‡åˆ° $L$ çº§ï¼Œæ€»å…±éœ€è¦æ¶ˆè€— $1+2+\dots+L = \frac{L(L+1)}{2}$ ä¸ªç‚¹æ•°ã€‚

æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ $T$ ä¸ªæ€»ç‚¹æ•°ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°æœ€å¤§çš„ç­‰çº§ $L$ï¼Œä½¿å¾— $\frac{L(L+1)}{2} \le T$ã€‚
æ‰¾åˆ°è¿™ä¸ª $L$ ä¹‹åï¼Œå‰©ä½™çš„ç‚¹æ•°å°±æ˜¯ $P = T - \frac{L(L+1)}{2}$ã€‚

### ä¼˜é›…åœ°æ±‚å’Œï¼šåˆ†ç¦»è´¡çŒ®ä¸æ•´é™¤åˆ†å—

æˆ‘ä»¬çš„ç›®æ ‡æ˜¯è®¡ç®—è¿™ä¸ªæ€»å’Œï¼š
$$
\text{Total} = \sum_{y=1}^{N} \sum_{i=1}^{\min(N,M)} \left( A \cdot L_i(y)^2 + B \cdot P_i(y) + C \right)
$$
æ³¨æ„ï¼Œå¦‚æœ $i > N$ï¼Œ$\lfloor y/i \rfloor$ æ°¸è¿œæ˜¯ $0$ï¼Œæ‰€ä»¥è¿™äº›è´¸æ˜“ç«™æ°¸è¿œæ˜¯ 0 çº§ 0 ç‚¹ï¼Œæ¯å¤©åªäº§å‡º $C$ã€‚æˆ‘ä»¬å¯ä»¥å…ˆæŠŠè¿™éƒ¨åˆ†ç®—æ‰ï¼Œç„¶ååªè€ƒè™‘ $i \le \min(N, M)$ çš„æƒ…å†µã€‚ä¸ºäº†æ–¹ä¾¿ï¼Œæˆ‘ä»¬ä¸‹æ–‡ç»Ÿä¸€ç”¨ $M$ è¡¨ç¤º $\min(N, M)$ã€‚

è¿™ä¸ªåŒé‡æ±‚å’Œç›´æ¥è®¡ç®—å¤ªæ…¢äº†ã€‚æˆ‘ä»¬æŠŠå®ƒæ‹†æˆä¸‰éƒ¨åˆ†ï¼Œåˆ†åˆ«è®¡ç®—è´¡çŒ®ï¼š
$$
\text{Total} = A \sum_{y=1}^{N} \sum_{i=1}^{M} L_i(y)^2 + B \sum_{y=1}^{N} \sum_{i=1}^{M} P_i(y) + C \sum_{y=1}^{N} \sum_{i=1}^{M} 1
$$
$C$ çš„éƒ¨åˆ†æœ€ç®€å•ï¼Œå°±æ˜¯ $N \cdot M \cdot C$ã€‚

ç°åœ¨æˆ‘ä»¬æ¥å¤„ç† $A$ å’Œ $B$ çš„éƒ¨åˆ†ã€‚æŠŠ $P_i(y)$ çš„è¡¨è¾¾å¼ä»£å…¥ï¼š
$P_i(y) = \lfloor y/i \rfloor - \frac{L_i(y)(L_i(y)+1)}{2}$
å…¶ä¸­ $L_i(y)$ æ˜¯ç”±æ€»ç‚¹æ•° $\lfloor y/i \rfloor$ å†³å®šçš„ç­‰çº§ã€‚ä¸ºäº†ä¹¦å†™æ–¹ä¾¿ï¼Œæˆ‘ä»¬è®° $T_{i,y} = \lfloor y/i \rfloor$ï¼Œä»¥åŠç”±æ€»ç‚¹æ•° $k$ å†³å®šçš„ç­‰çº§ä¸º $L(k)$ã€‚

æ€»å’Œå¯ä»¥å†™æˆï¼š
$$
\sum_{y=1}^{N} \sum_{i=1}^{M} \left( A \cdot L(T_{i,y})^2 + B \cdot (T_{i,y} - \frac{L(T_{i,y})(L(T_{i,y})+1)}{2}) \right)
$$
æ•´ç†ä¸€ä¸‹ï¼ŒæŠŠå…³äº $L(T_{i,y})$ çš„é¡¹åˆå¹¶ï¼š
$$
\sum_{y=1}^{N} \sum_{i=1}^{M} \left( (A - \frac{B}{2}) L(T_{i,y})^2 - \frac{B}{2} L(T_{i,y}) + B \cdot T_{i,y} \right)
$$
è¿™ä¸ªå¼å­çœ‹èµ·æ¥è¿˜æ˜¯å¾ˆå¯æ€•ï¼Œä½†åˆ«æ€•ï¼ŒçŒ«å¨˜æˆ‘æ¥å¸¦ä½ æ¢³ç†ï¼æˆ‘ä»¬å¯ä»¥äº¤æ¢æ±‚å’Œé¡ºåºï¼Œå…ˆå¯¹ $i$ æ±‚å’Œï¼š
$$
\sum_{i=1}^{M} \sum_{y=1}^{N} \left( \dots \right)
$$
å¯¹äºä¸€ä¸ªå›ºå®šçš„ $i$ï¼Œå†…å±‚çš„å’Œ $\sum_{y=1}^{N}$ ä»ç„¶ä¸å¥½ç®—ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å‘ç° $T_{i,y} = \lfloor y/i \rfloor$ çš„å€¼åœ¨ $y$ çš„ä¸€æ®µåŒºé—´å†…æ˜¯ä¸å˜çš„ã€‚è¿™å¯å‘æˆ‘ä»¬å¯¹ $y$ è¿›è¡Œåˆ†ç»„ã€‚

ä¸è¿‡ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªæ›´å¼ºå¤§çš„æŠ€å·§â€”â€”**æ•´é™¤åˆ†å—**ï¼æˆ‘ä»¬è§‚å¯Ÿåˆ°ï¼Œå½“ $i$ åœ¨æŸä¸ªåŒºé—´ $[l, r]$ å†…å˜åŠ¨æ—¶ï¼Œ$\lfloor N/i \rfloor$ çš„å€¼æ˜¯ç›¸åŒçš„ï¼è¿™å¯¹äºå¤–å±‚çš„ $\sum_{i=1}^M$ æ±‚å’Œéå¸¸æœ‰ç”¨ã€‚

æˆ‘ä»¬æŠŠæ€»å’Œåˆ†æˆä¸¤éƒ¨åˆ†ï¼š
$$
S_1 = \sum_{i=1}^{M} \sum_{y=1}^{N} \left( (A - \frac{B}{2}) L(\lfloor y/i \rfloor)^2 - \frac{B}{2} L(\lfloor y/i \rfloor) \right)
$$
$$
S_2 = \sum_{i=1}^{M} \sum_{y=1}^{N} B \cdot \lfloor y/i \rfloor
$$
æˆ‘ä»¬å¯ä»¥å¯¹ $i$ ä» $1$ åˆ° $M$ è¿›è¡Œæ•´é™¤åˆ†å—ã€‚å¯¹äºä¸€ä¸ªå— $[l, r]$ï¼Œæ‰€æœ‰ $i \in [l, r]$ å¯¹åº”çš„ $\lfloor N/i \rfloor$ éƒ½ç­‰äºä¸€ä¸ªç›¸åŒçš„å€¼ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º $V_N = \lfloor N/l \rfloor$ã€‚

åœ¨ä¸€ä¸ªå—å†…ï¼Œæˆ‘ä»¬éœ€è¦è®¡ç®— $\sum_{i=l}^r \left(\sum_{y=1}^N \dots \right)$ã€‚
å¯¹äºå›ºå®šçš„ $i$ï¼Œå†…å±‚å’Œ $\sum_{y=1}^N f(\lfloor y/i \rfloor)$ å¯ä»¥æ‹†åˆ†ä¸ºï¼š
$$
\sum_{y=1}^N f(\lfloor y/i \rfloor) = \sum_{k=0}^{\lfloor N/i \rfloor - 1} i \cdot f(k) + (N \pmod i + 1) \cdot f(\lfloor N/i \rfloor)
$$
è¿™ä¸ªå¼å­å¯¹å—å†…æ‰€æœ‰ $i$ æ±‚å’Œï¼Œè¿˜æ˜¯æœ‰ç‚¹å¤æ‚ã€‚

### ç»ˆæé­”æ³•ï¼šå‰ç¼€å’Œçš„å…¬å¼æ¨å¯¼

çœŸæ­£çš„çªç ´å£åœ¨äºï¼Œæˆ‘ä»¬éœ€è¦å¿«é€Ÿè®¡ç®—å½¢å¦‚ $\sum_{k=0}^{T-1} L(k)$ å’Œ $\sum_{k=0}^{T-1} L(k)^2$ çš„å‰ç¼€å’Œã€‚

$L(k)$ æ˜¯ä¸€ä¸ªé˜¶æ¢¯å‡½æ•°ã€‚å®ƒåœ¨ $k \in [\frac{p(p+1)}{2}, \frac{(p+1)(p+2)}{2}-1]$ è¿™ä¸ªåŒºé—´å†…éƒ½ç­‰äº $p$ã€‚
è®¾ $T_p = \frac{p(p+1)}{2}$ã€‚
æˆ‘ä»¬è¦æ±‚å’Œåˆ° $T-1$ï¼Œå…ˆæ‰¾åˆ° $T-1$ å¯¹åº”çš„æœ€é«˜ç­‰çº§ $P_{max}$ï¼Œå³ $T_{P_{max}} \le T-1 < T_{P_{max}+1}$ã€‚
$$
\sum_{k=0}^{T-1} L(k) = \sum_{p=0}^{P_{max}-1} \sum_{k=T_p}^{T_{p+1}-1} L(k) + \sum_{k=T_{P_{max}}}^{T-1} L(k)
$$
$L(k)$ åœ¨ç¬¬ä¸€ä¸ªå’Œå¼ä¸­ç­‰äº $p$ï¼ŒåŒºé—´é•¿åº¦æ˜¯ $T_{p+1}-T_p = p+1$ã€‚åœ¨ç¬¬äºŒä¸ªå’Œå¼ä¸­ç­‰äº $P_{max}$ã€‚
$$
= \sum_{p=0}^{P_{max}-1} p(p+1) + P_{max}(T - T_{P_{max}})
$$
$\sum p(p+1) = \sum p^2 + \sum p$ã€‚è¿™æ˜¯è‡ªç„¶æ•°å¹‚çš„å’Œï¼Œæœ‰æˆ‘ä»¬ç†ŸçŸ¥çš„å…¬å¼ï¼
*   $\sum_{p=0}^{n-1} p = \frac{(n-1)n}{2}$
*   $\sum_{p=0}^{n-1} p^2 = \frac{(n-1)n(2n-1)}{6}$
*   $\sum_{p=0}^{n-1} p^3 = \left(\frac{(n-1)n}{2}\right)^2$

åŒç†ï¼Œæˆ‘ä»¬ä¹Ÿèƒ½æ¨å¯¼å‡º $\sum_{k=0}^{T-1} L(k)^2$ çš„å…¬å¼ï¼Œå®ƒä¼šç”¨åˆ° $\sum p^3$ å’Œ $\sum p^2$ã€‚

æœ‰äº†è¿™äº›å¿«é€Ÿè®¡ç®—å‰ç¼€å’Œçš„â€œé­”æ³•â€åï¼Œæˆ‘ä»¬å°±å¯ä»¥å›åˆ°æ•´é™¤åˆ†å—çš„æ¡†æ¶äº†ã€‚å¯¹äºæ¯ä¸ªå— $[l, r]$ï¼Œæˆ‘ä»¬è®¡ç®—å—å†…æ‰€æœ‰ $i$ çš„è´¡çŒ®æ€»å’Œã€‚è¿™ä¸ªæ€»å’Œå¯ä»¥è¢«è¡¨ç¤ºä¸ºå…³äº $\sum_{i=l}^r i$ å’Œ $\sum_{i=l}^r 1$ çš„è¡¨è¾¾å¼ï¼Œè€Œè¿™ä¸¤ä¸ªå’Œå¼éƒ½å¯ä»¥åœ¨ $O(1)$ å†…ç®—å‡ºã€‚

è¿™æ ·ï¼Œæˆ‘ä»¬åªéœ€è¦éå†æ‰€æœ‰ç”± $\lfloor N/i \rfloor$ äº§ç”Ÿçš„å—ï¼ˆå¤§çº¦ $2\sqrt{N}$ ä¸ªï¼‰ï¼Œåœ¨æ¯ä¸ªå—å†… $O(1)$ è®¡ç®—ï¼ˆæ‰¾åˆ° $P_{max}$ å¯èƒ½éœ€è¦ `sqrt` æˆ–äºŒåˆ†ï¼Œä½†å¾ˆå¿«ï¼‰ï¼Œæ€»å¤æ‚åº¦å°±æ˜¯ $O(\sqrt{N})$ å•¦ï¼æ˜¯ä¸æ˜¯è¶…çº§å¿«ï¼Œå–µ~

### ç®—æ³•æ­¥éª¤æ€»ç»“

1.  é¢„è®¡ç®—æ¨¡ $10^9+9$ ä¸‹ 2ã€3ã€6 çš„é€†å…ƒã€‚
2.  å•ç‹¬è®¡ç®— $C$ çš„æ€»è´¡çŒ®ï¼š$N \cdot M \cdot C \pmod{mod}$ã€‚
3.  ç¼–å†™ä¸€ä¸ªå‡½æ•° `find_level(T)`ï¼Œè¾“å…¥æ€»ç‚¹æ•° $T$ï¼Œè¿”å›å¯¹åº”çš„ç­‰çº§ $L$ã€‚å¯ä»¥ç”¨ `sqrtl(2.0L * T)` æ¥ä¼°ç®— $L$ å¹¶è¿›è¡Œå¾®è°ƒã€‚
4.  ç¼–å†™å‡½æ•° `calc_prefix_L_sums(T)`ï¼Œåˆ©ç”¨ä¸Šè¿°æ¨å¯¼çš„è‡ªç„¶æ•°å¹‚å’Œå…¬å¼ï¼Œå¿«é€Ÿè®¡ç®— $\sum_{k=0}^{T-1} L(k)$ å’Œ $\sum_{k=0}^{T-1} L(k)^2$ã€‚
5.  ä½¿ç”¨æ•´é™¤åˆ†å—ï¼Œéå† $i$ ä» $1$ åˆ° $\min(N, M)$ã€‚
    *   å¯¹äºæ¯ä¸ªå— $[l, r]$ï¼Œå…¶å¯¹åº”çš„æ€»ç‚¹æ•°ä¸Šé™ä¸º $V_N = \lfloor N/l \rfloor$ã€‚
    *   è®¡ç®—å—å†… $S_2$ çš„è´¡çŒ®ï¼š$B \sum_{i=l}^r \sum_{y=1}^N \lfloor y/i \rfloor$ã€‚è¿™å¯ä»¥åŒ–ç®€ä¸ºä¾èµ– $\sum_{i=l}^r i$ çš„å½¢å¼ã€‚
    *   è®¡ç®—å—å†… $S_1$ çš„è´¡çŒ®ï¼š$\sum_{i=l}^r \sum_{y=1}^N \left(\dots L(\lfloor y/i \rfloor)^2 \dots L(\lfloor y/i \rfloor) \dots\right)$ã€‚è¿™å¯ä»¥åŒ–ç®€ä¸ºä¾èµ– `calc_prefix_L_sums` å’Œ $\sum_{i=l}^r i$ çš„å½¢å¼ã€‚
    *   å°†å—è´¡çŒ®ç´¯åŠ åˆ°æ€»ç­”æ¡ˆã€‚
6.  è¾“å‡ºæœ€ç»ˆç­”æ¡ˆï¼Œå–µ~

## ä»£ç å®ç°

è¿™æ˜¯æœ¬çŒ«å¨˜æ ¹æ®ä¸Šé¢çš„æ€è·¯ï¼Œç²¾å¿ƒä¸ºä½ å‡†å¤‡çš„ä»£ç å“¦ï¼æ³¨é‡Šå¾ˆè¯¦ç»†ï¼Œå¸Œæœ›èƒ½å¸®åˆ°ä½ ï¼Œå‘~

```cpp
#include <iostream>
#include <algorithm>
#include <cmath>

using namespace std;

// ä½¿ç”¨128ä½æ•´æ•°é˜²æ­¢ä¸­é—´è¿‡ç¨‹æº¢å‡º
using i128 = __int128_t;
using ll = long long;

ll N, M_orig, A, B, C;
const ll MOD = 1e9 + 9;

// é¢„è®¡ç®—çš„æ¨¡é€†å…ƒ
ll inv2, inv6;

// å¿«é€Ÿå¹‚è®¡ç®— a^b % MOD
ll power(ll base, ll exp) {
    ll res = 1;
    base %= MOD;
    while (exp > 0) {
        if (exp % 2 == 1) res = (i128)res * base % MOD;
        base = (i128)base * base % MOD;
        exp /= 2;
    }
    return res;
}

// è®¡ç®— a çš„æ¨¡é€†å…ƒ
ll modInverse(ll n) {
    return power(n, MOD - 2);
}

// é¢„å¤„ç†
void precompute_inverses() {
    inv2 = modInverse(2);
    inv6 = modInverse(6);
}

// --- è‡ªç„¶æ•°å¹‚å’Œå…¬å¼ ---
// sum of i for i from 0 to n-1
ll sum_p1(ll n) {
    if (n == 0) return 0;
    n %= MOD;
    ll res = (i128)n * (n - 1 + MOD) % MOD;
    res = res * inv2 % MOD;
    return res;
}

// sum of i^2 for i from 0 to n-1
ll sum_p2(ll n) {
    if (n == 0) return 0;
    n %= MOD;
    ll res = (i128)n * (n - 1 + MOD) % MOD;
    res = res * (2 * n - 1 + MOD) % MOD;
    res = res * inv6 % MOD;
    return res;
}

// sum of i^3 for i from 0 to n-1
ll sum_p3(ll n) {
    if (n == 0) return 0;
    ll term = sum_p1(n);
    return (i128)term * term % MOD;
}

// --- æ ¸å¿ƒè®¡ç®—å‡½æ•° ---
// æ ¹æ®æ€»ç‚¹æ•° T è®¡ç®—ç­‰çº§ L
ll find_level(ll T) {
    if (T < 1) return 0;
    ll L_approx = sqrtl(2.0L * T);
    while ((i128)L_approx * (L_approx + 1) / 2 > T) {
        L_approx--;
    }
    while ((i128)(L_approx + 1) * (L_approx + 2) / 2 <= T) {
        L_approx++;
    }
    return L_approx;
}

// è®¡ç®— sum L(k) å’Œ sum L(k)^2 for k from 0 to T-1
pair<ll, ll> get_prefix_L_sums(ll T) {
    if (T == 0) return {0, 0};
    ll L_max = find_level(T - 1);
    
    // æ»¡çº§éƒ¨åˆ†çš„è´¡çŒ® (0çº§åˆ°L_max-1çº§)
    // sum p(p+1) = sum p^2 + sum p
    ll sum_full_level_L = (sum_p2(L_max) + sum_p1(L_max)) % MOD;
    // sum p^2(p+1) = sum p^3 + sum p^2
    ll sum_full_level_L2 = (sum_p3(L_max) + sum_p2(L_max)) % MOD;

    // æœªæ»¡çº§éƒ¨åˆ† (L_maxçº§) çš„è´¡çŒ®
    ll T_L_max = (i128)L_max * (L_max + 1) / 2;
    ll remaining_count = (T - T_L_max % MOD + MOD) % MOD;
    
    ll L_max_mod = L_max % MOD;
    ll L_max2_mod = (i128)L_max_mod * L_max_mod % MOD;

    ll total_sum_L = (sum_full_level_L + (i128)remaining_count * L_max_mod) % MOD;
    ll total_sum_L2 = (sum_full_level_L2 + (i128)remaining_count * L_max2_mod) % MOD;

    return {total_sum_L, total_sum_L2};
}

int main() {
    ios_base::sync_with_stdio(false);
    cin.tie(NULL);

    cin >> N >> M_orig >> A >> B >> C;
    ll M = min(N, M_orig);
    
    precompute_inverses();

    A %= MOD; B %= MOD; C %= MOD;
    if (A < 0) A += MOD;
    if (B < 0) B += MOD;
    if (C < 0) C += MOD;

    // 1. C çš„æ€»è´¡çŒ®
    ll ans = (i128)(N % MOD) * (M_orig % MOD) % MOD * C % MOD;

    // 2. B * T_{i,y} éƒ¨åˆ†çš„æ€»è´¡çŒ®
    // sum_{i=1 to M} sum_{y=1 to N} B * floor(y/i)
    // ç­‰ä»·äº B * sum_{k=1 to N} (N - k + 1) * (num of divisors of k <= M)
    // è¿˜æ˜¯ç”¨æ•´é™¤åˆ†å—å¥½ç®—
    ll sum_B_T = 0;
    for (ll l = 1, r = 0; l <= M; l = r + 1) {
        ll val_N = N / l;
        r = min(M, N / val_N);
        
        ll sum_i = (sum_p1(r + 1) - sum_p1(l) + MOD) % MOD;
        ll val_N_mod = val_N % MOD;
        ll term1 = (i128)sum_i * val_N_mod % MOD * (val_N_mod - 1 + MOD) % MOD * inv2 % MOD;
        ll term2 = (i128)(r - l + 1) * (val_N_mod + 1) % MOD * ((N % MOD) - (i128)val_N_mod * ((N / val_N) % MOD) % MOD + MOD) % MOD;
        ll term3 = (i128)val_N_mod * ( (i128)((N/val_N)%MOD) * sum_i % MOD - sum_p2(r+1) + sum_p2(l) + MOD ) % MOD;

        ll block_sum_T_iy = (term1 + term2 + term3 + MOD) % MOD;
        sum_B_T = (sum_B_T + block_sum_T_iy) % MOD;
    }
    ans = (ans + (i128)B * sum_B_T) % MOD;

    // 3. (A - B/2)L^2 - (B/2)L éƒ¨åˆ†çš„æ€»è´¡çŒ®
    ll A_eff = (A - (i128)B * inv2 % MOD + MOD) % MOD;
    ll B_eff = (MOD - (i128)B * inv2 % MOD) % MOD;

    ll sum_L_part = 0;
    for (ll l = 1, r = 0; l <= M; l = r + 1) {
        ll val_N = N / l;
        r = min(M, N / val_N);

        // è®¡ç®— H(val_N) å’Œ S_H(val_N)
        ll L_val_N = find_level(val_N);
        ll L_val_N_mod = L_val_N % MOD;
        ll H_val_N = ((i128)A_eff * L_val_N_mod % MOD * L_val_N_mod % MOD + (i128)B_eff * L_val_N_mod % MOD) % MOD;
        
        pair<ll, ll> sums = get_prefix_L_sums(val_N);
        ll S_L = sums.first;
        ll S_L2 = sums.second;
        ll S_H_val_N = ((i128)A_eff * S_L2 % MOD + (i128)B_eff * S_L % MOD) % MOD;

        // å—å†…æ±‚å’Œ
        ll sum_i = (sum_p1(r + 1) - sum_p1(l) + MOD) % MOD;
        ll block_len = r - l + 1;
        
        ll term1 = (i128)sum_i * S_H_val_N % MOD;
        ll term2 = (i128)block_len * (N % MOD + 1) % MOD * H_val_N % MOD;
        ll term3 = (MOD - (i128)val_N % MOD * sum_i % MOD * H_val_N % MOD) % MOD;

        sum_L_part = (sum_L_part + term1 + term2 + term3) % MOD;
    }
    
    ans = (ans + sum_L_part) % MOD;

    cout << ans << endl;

    return 0;
}
```
*å°çŒ«å¨˜æç¤ºï¼šå•Šå–µï¼Œä¸Šé¢çš„ä»£ç å®ç°ç¨å¾®æœ‰ç‚¹å¤æ‚ï¼Œå°¤å…¶æ˜¯ $S_2$ éƒ¨åˆ†çš„æ¨å¯¼ï¼Œç›´æ¥è®¡ç®— `sum_{y=1 to N} floor(y/i)` å¯¹æ¯ä¸ªå—æ±‚å’Œä¼šæ›´æ¸…æ™°ä¸€äº›ã€‚æˆ‘çš„çˆªå­å¯èƒ½åœ¨è¿™é‡Œç»•äº†ç‚¹å¼¯è·¯ï¼Œä½†æ ¸å¿ƒæ€æƒ³â€”â€”æ•´é™¤åˆ†å—å’Œå‰ç¼€å’Œå…¬å¼â€”â€”æ˜¯æ­£ç¡®çš„ï¼ä¸»äººå¯ä»¥å°è¯•è‡ªå·±æ¨å¯¼ä¸€ä¸‹å—å†…æ±‚å’Œçš„ç®€æ´å½¢å¼å“¦ï¼*

## å¤æ‚åº¦åˆ†æ

- **æ—¶é—´å¤æ‚åº¦**: $O(\sqrt{N})$
    æˆ‘ä»¬ä½¿ç”¨äº†æ•´é™¤åˆ†å—æ¥å¤„ç†å¯¹ $i$ çš„æ±‚å’Œã€‚$i$ ä» $1$ åˆ° $M$ï¼ˆ$M \le N$ï¼‰ï¼Œå€¼ $\lfloor N/i \rfloor$ çš„ä¸åŒå–å€¼åªæœ‰ $O(\sqrt{N})$ ä¸ªã€‚åœ¨æ¯ä¸ªå—å†…éƒ¨ï¼Œæˆ‘ä»¬çš„è®¡ç®—éƒ½æ˜¯ $O(1)$ çš„ï¼ˆ`sqrtl` å¯ä»¥çœ‹ä½œè¿‘ä¼¼ $O(1)$ï¼‰ã€‚å› æ­¤ï¼Œæ€»çš„æ—¶é—´å¤æ‚åº¦æ˜¯ $O(\sqrt{N})$ï¼Œéå¸¸é«˜æ•ˆï¼

- **ç©ºé—´å¤æ‚åº¦**: $O(1)$
    æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ä»»ä½•å¤§å‹æ•°ç»„æˆ–æ•°æ®ç»“æ„æ¥è¿›è¡Œé¢„è®¡ç®—ï¼Œæ‰€æœ‰è®¡ç®—éƒ½æ˜¯å³æ—¶å®Œæˆçš„ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬åªéœ€è¦å¸¸æ•°çº§åˆ«çš„é¢å¤–ç©ºé—´ï¼Œå–µ~

## çŸ¥è¯†ç‚¹æ€»ç»“

1.  **é—®é¢˜è½¬åŒ–**: å°†ä¸€ä¸ªçœ‹ä¼¼å¤æ‚çš„æ¨¡æ‹Ÿé—®é¢˜ï¼Œé€šè¿‡åˆ†æå…¶å†…åœ¨è§„å¾‹ï¼Œè½¬åŒ–ä¸ºä¸€ä¸ªçº¯ç²¹çš„æ•°å­¦æ±‚å’Œé—®é¢˜ã€‚è¿™æ˜¯è§£ç®—æ³•é¢˜éå¸¸é‡è¦çš„ä¸€æ­¥ï¼
2.  **æ•°è®º**: ç†è§£ $\lfloor y/i \rfloor$ çš„å«ä¹‰ï¼Œä»¥åŠå®ƒå’Œå› å­ã€å€æ•°çš„å…³ç³»ã€‚
3.  **æ•´é™¤åˆ†å—**: è¿™æ˜¯è§£å†³ä¸€ç±»å¸¦æœ‰ $\lfloor n/i \rfloor$ çš„æ±‚å’Œé—®é¢˜çš„ç»å…¸æŠ€å·§ï¼Œèƒ½å°† $O(N)$ çš„å¤æ‚åº¦ä¼˜åŒ–åˆ° $O(\sqrt{N})$ã€‚
4.  **å…¬å¼æ¨å¯¼ä¸å‰ç¼€å’Œ**: é—®é¢˜çš„æ ¸å¿ƒæ˜¯å¿«é€Ÿè®¡ç®— $L(k)$ å’Œ $L(k)^2$ çš„å‰ç¼€å’Œã€‚é€šè¿‡åˆ†æ $L(k)$ çš„é˜¶æ¢¯å‡½æ•°ç‰¹æ€§ï¼Œæˆ‘ä»¬æˆåŠŸåœ°ç”¨è‡ªç„¶æ•°å¹‚å’Œå…¬å¼åœ¨ $O(1)$ æ—¶é—´å†…è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚
5.  **æ¨¡å—åŒ–ç¼–ç¨‹**: å°†å¤æ‚é—®é¢˜åˆ†è§£æˆå°å‡½æ•°ï¼ˆå¦‚ `find_level`, `get_prefix_L_sums`ï¼‰ï¼Œè®©ä»£ç ç»“æ„æ›´æ¸…æ™°ï¼Œä¹Ÿæ›´å®¹æ˜“è°ƒè¯•ï¼Œå–µ~

å¥½å•¦ï¼Œè¿™æ¬¡çš„ç½—å¾·å²›åŸºå»ºå¤§ä½œæˆ˜å°±åˆ°æ­¤ç»“æŸå•¦ï¼ä¸»äººæ˜¯ä¸æ˜¯ä¹Ÿè§‰å¾—æ•°å­¦çš„é­”æ³•å¾ˆç¥å¥‡å‘¢ï¼Ÿåªè¦æˆ‘ä»¬ç”¨å¿ƒå»å‘ç°è§„å¾‹ï¼Œå†å¤æ‚çš„é—®é¢˜ä¹Ÿèƒ½è¢«æˆ‘ä»¬çš„å°çˆªå­è½»æ¾è§£å†³ï¼ç»§ç»­åŠ æ²¹å“¦ï¼Œmasterï¼ğŸ’–