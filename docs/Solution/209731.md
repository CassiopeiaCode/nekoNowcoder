# JosephusTransform - é¢˜è§£

### æ ‡ç­¾ä¸éš¾åº¦
> **æ ‡ç­¾**: ç½®æ¢ç¾¤, å¿«é€Ÿå¹‚, æ ‘çŠ¶æ•°ç»„, æ¨¡æ‹Ÿ, çº¦ç‘Ÿå¤«é—®é¢˜
> **éš¾åº¦**: 2200

## é¢˜ç›®å¤§æ„å–µ~

ä¸»äººä½ å¥½å‘€ï¼Œå–µ~ è¿™é“é¢˜æ˜¯è¿™æ ·çš„ï¼š

ä¸€å¼€å§‹ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªä» 1 åˆ° $n$ çš„æ’åˆ— $P = \{1, 2, \dots, n\}$ã€‚
ç„¶åå‘¢ï¼Œä¼šæœ‰ $m$ æ¬¡æ“ä½œã€‚æ¯æ¬¡æ“ä½œä¼šç»™ä½ ä¸€å¯¹æ•°å­— $(k, x)$ã€‚

è¿™ä¸ªæ“ä½œçš„æ„æ€æ˜¯ï¼Œæˆ‘ä»¬è¦å¯¹å½“å‰çš„æ’åˆ— $P$ æ‰§è¡Œ $x$ æ¬¡â€œ$k$-çº¦ç‘Ÿå¤«å˜æ¢â€ã€‚

é‚£ä»€ä¹ˆæ˜¯â€œ$k$-çº¦ç‘Ÿå¤«å˜æ¢â€å‘¢ï¼Ÿå°±æ˜¯ï¼š
1.  æŠŠå½“å‰æ’åˆ— $P$ çš„æ‰€æœ‰æ•°å­—çœ‹æˆä¸€ä¸ªç¯ã€‚
2.  ä»ç¯çš„ç¬¬ä¸€ä¸ªæ•°å­—å¼€å§‹ï¼Œé¡ºæ—¶é’ˆæ•° $k$ ä¸ªã€‚æŠŠæ•°åˆ°çš„é‚£ä¸ªæ•°å­—ä»ç¯é‡Œæ‹¿å‡ºæ¥ï¼Œæ”¾åˆ°ä¸€ä¸ªæ–°æ’åˆ— $P'$ çš„æœ«å°¾ã€‚
3.  æ¥ç€ä»åˆšæ‰è¢«ç§»é™¤çš„æ•°å­—çš„ä¸‹ä¸€ä¸ªä½ç½®å¼€å§‹ï¼Œç»§ç»­åœ¨å‰©ä¸‹çš„æ•°å­—é‡Œæ•° $k$ ä¸ªï¼Œå†æ‹¿å‡ºæ¥æ”¾åˆ° $P'$ çš„æœ«å°¾ã€‚
4.  é‡å¤è¿™ä¸ªè¿‡ç¨‹ï¼Œç›´åˆ°æ‰€æœ‰æ•°å­—éƒ½è¢«å–å‡ºæ¥ï¼Œå½¢æˆæ–°çš„æ’åˆ— $P'$ã€‚
5.  è¿™ä¸ª $P'$ å°±æ˜¯è¿›è¡Œäº†ä¸€æ¬¡â€œ$k$-çº¦ç‘Ÿå¤«å˜æ¢â€åçš„ç»“æœã€‚

ä¸¾ä¸ªæ —å­ï¼å¦‚æœ $P = \{1, 2, 3, 4, 5\}$ï¼Œè¿›è¡Œä¸€æ¬¡ $k=3$ çš„å˜æ¢ï¼š
-   åˆå§‹ç¯: `(1, 2, 3, 4, 5)`ã€‚ä» 1 å¼€å§‹æ•° 3 ä¸ªï¼Œæ˜¯ `3`ã€‚æ‹¿å‡º `3`ã€‚$P'=\{3\}$ã€‚
-   å‰©ä¸‹ç¯: `(1, 2, 4, 5)`ã€‚ä» `4` å¼€å§‹æ•° 3 ä¸ªï¼Œæ˜¯ `1`ã€‚æ‹¿å‡º `1`ã€‚$P'=\{3, 1\}$ã€‚
-   å‰©ä¸‹ç¯: `(2, 4, 5)`ã€‚ä» `2` å¼€å§‹æ•° 3 ä¸ªï¼Œæ˜¯ `5`ã€‚æ‹¿å‡º `5`ã€‚$P'=\{3, 1, 5\}$ã€‚
-   å‰©ä¸‹ç¯: `(2, 4)`ã€‚ä» `2` å¼€å§‹æ•° 3 ä¸ªï¼Œæ˜¯ `2`ã€‚æ‹¿å‡º `2`ã€‚$P'=\{3, 1, 5, 2\}$ã€‚
-   å‰©ä¸‹ç¯: `(4)`ã€‚ä» `4` å¼€å§‹æ•° 1 ä¸ªï¼Œæ˜¯ `4`ã€‚æ‹¿å‡º `4`ã€‚$P'=\{3, 1, 5, 2, 4\}$ã€‚
æ‰€ä»¥å˜æ¢ä¸€æ¬¡åï¼Œæ’åˆ—å°±å˜æˆäº† $\{3, 1, 5, 2, 4\}$ å•¦ã€‚

æˆ‘ä»¬çš„ä»»åŠ¡å°±æ˜¯ï¼Œåœ¨æ‰€æœ‰ $m$ æ¬¡æ“ä½œä¹‹åï¼ŒæŠŠæœ€ç»ˆçš„æ’åˆ—æ‰“å°å‡ºæ¥ã€‚å–µ~

## è§£é¢˜æ€è·¯åˆ†æ

è¿™é“é¢˜çœ‹èµ·æ¥æœ‰ç‚¹å¤æ‚ï¼Œç‰¹åˆ«æ˜¯è¦å˜æ¢å¥½å¤šæ¬¡ï¼Œä½†æ˜¯åˆ«æ€•ï¼Œæœ¬çŒ«å¨˜å¸¦ä½ ä¸€æ­¥ä¸€æ­¥æŠŠå®ƒæ‹†è§£å¼€ï¼Œå°±åƒæ‹†æ¯›çº¿çƒä¸€æ ·ç®€å•ï¼Œå–µ~

æˆ‘ä»¬å¯ä»¥æŠŠæ•´ä¸ªé—®é¢˜åˆ†æˆä¸¤ä¸ªæ ¸å¿ƒéƒ¨åˆ†ï¼š
1.  å¦‚ä½•é«˜æ•ˆåœ°æ¨¡æ‹Ÿ **ä¸€æ¬¡** â€œ$k$-çº¦ç‘Ÿå¤«å˜æ¢â€ï¼Ÿ
2.  å¦‚ä½•é«˜æ•ˆåœ°æŠŠè¿™ä¸ªå˜æ¢ **é‡å¤ $x$ æ¬¡**ï¼Ÿ

### Part 1: é«˜æ•ˆæ¨¡æ‹Ÿä¸€æ¬¡å˜æ¢ ğŸ¾

ä¸€æ¬¡å˜æ¢çš„æ ¸å¿ƒï¼Œå…¶å®å°±æ˜¯ä¸æ–­åœ°â€œåœ¨å‰©ä¸‹çš„æ•°å­—ä¸­æ‰¾åˆ°ç¬¬ $k$ ä¸ªâ€ã€‚

å¦‚æœç”¨ä¸€ä¸ªæ™®é€šçš„ `std::vector` æ¥æ¨¡æ‹Ÿï¼Œæ¯æ¬¡æ‰¾åˆ°æ•°å­—ååˆ é™¤å®ƒï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ $O(N)$ã€‚å› ä¸ºæ€»å…±æœ‰ $N$ ä¸ªæ•°å­—è¦è¢«ç§»é™¤ï¼Œæ‰€ä»¥æ¨¡æ‹Ÿä¸€æ¬¡å˜æ¢çš„æ€»æ—¶é—´å°±æ˜¯ $O(N^2)$ã€‚å¯¹äº $N=10^5$ çš„æ•°æ®è§„æ¨¡ï¼Œè¿™è‚¯å®šä¼šè¶…æ—¶çš„è¯´ï¼å°±åƒè¿½è‡ªå·±çš„å°¾å·´ï¼Œè½¬äº†åŠå¤©è¿˜åœ¨åŸåœ°ï¼Œå–µå‘œ~

æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ›´å¿«çš„â€œçˆªå­â€æ¥æŠ“åˆ°ç¬¬ $k$ ä¸ªæ•°å­—ï¼ä»€ä¹ˆæ•°æ®ç»“æ„èƒ½åšåˆ°å‘¢ï¼Ÿ
ç­”æ¡ˆå°±æ˜¯ **æ ‘çŠ¶æ•°ç»„ (Fenwick Tree)** æˆ–è€… **çº¿æ®µæ ‘ (Segment Tree)**ï¼

æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªå¤§å°ä¸º $N$ çš„æ ‘çŠ¶æ•°ç»„ï¼Œ`tree[i]` è¡¨ç¤ºç¬¬ $i$ ä¸ªä½ç½®çš„æ•°å­—æ˜¯å¦è¿˜â€œå­˜æ´»â€ã€‚åˆå§‹æ—¶ï¼Œæ‰€æœ‰ä½ç½®éƒ½æ˜¯ 1ï¼ˆå­˜æ´»ï¼‰ã€‚å½“ä¸€ä¸ªæ•°å­—è¢«ç§»é™¤æ—¶ï¼Œæˆ‘ä»¬æŠŠå¯¹åº”ä½ç½®çš„å€¼æ›´æ–°ä¸º 0ã€‚

-   **æŸ¥è¯¢**ï¼šæ ‘çŠ¶æ•°ç»„çš„å‰ç¼€å’Œ `query(p)` å¯ä»¥å‘Šè¯‰æˆ‘ä»¬ä»ä½ç½® 1 åˆ° $p$ è¿˜æœ‰å¤šå°‘ä¸ªå­˜æ´»çš„æ•°å­—ã€‚
-   **æŸ¥æ‰¾**ï¼šè¦æ‰¾â€œç¬¬ $k$ ä¸ªå­˜æ´»çš„æ•°å­—â€ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨æ ‘çŠ¶æ•°ç»„ä¸Šè¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼ˆæˆ–è€…ä¸€ç§æ›´å¿«çš„å«åšâ€œå€å¢â€æˆ–â€œäºŒè¿›åˆ¶çˆ¬å‡â€çš„æŠ€å·§ï¼‰æ¥å®ç°ã€‚è¿™ä¸ªæ“ä½œçš„å¤æ‚åº¦æ˜¯ $O(\log N)$ã€‚

æ‰€ä»¥ï¼Œæ¨¡æ‹Ÿä¸€æ¬¡å®Œæ•´çš„ $k$-çº¦ç‘Ÿå¤«å˜æ¢ï¼Œéœ€è¦è¿›è¡Œ $N$ æ¬¡æŸ¥æ‰¾å’Œ $N$ æ¬¡æ›´æ–°ï¼Œæ€»å¤æ‚åº¦å°±æ˜¯ $O(N \log N)$ã€‚è¿™ä¸‹é€Ÿåº¦å°±å¿«å¤šå•¦ï¼

å…·ä½“æ¨¡æ‹Ÿè¿‡ç¨‹æ˜¯è¿™æ ·çš„ï¼š
æˆ‘ä»¬ç»´æŠ¤ä¸€ä¸ªå½“å‰æŒ‡é’ˆ `cursor` å’Œå‰©ä½™äººæ•° `remaining`ã€‚
åœ¨ç¬¬ $i$ è½®ï¼ˆ$i$ ä» 1 åˆ° $N$ï¼‰ï¼š
1.  å½“å‰å‰©ä¸‹ `remaining = N - i + 1` ä¸ªäººã€‚
2.  æˆ‘ä»¬éœ€è¦æ•° `steps = (k - 1) % remaining + 1` æ­¥ã€‚
3.  åˆ©ç”¨æ ‘çŠ¶æ•°ç»„çš„ $O(\log N)$ æŸ¥è¯¢ï¼Œæ‰¾åˆ°ä» `cursor` å¼€å§‹çš„ç¬¬ `steps` ä¸ªå­˜æ´»çš„ä½ç½®ã€‚
4.  è®°å½•ä¸‹è¿™ä¸ªä½ç½®çš„åŸå§‹ç¼–å·ï¼Œç„¶åæ›´æ–°æ ‘çŠ¶æ•°ç»„ï¼ŒæŠŠè¿™ä¸ªä½ç½®æ ‡è®°ä¸ºâ€œå·²ç§»é™¤â€ã€‚
5.  æ›´æ–° `cursor` åˆ°è¿™ä¸ªè¢«ç§»é™¤çš„ä½ç½®ã€‚

é€šè¿‡è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ª**ç½®æ¢**ï¼ˆPermutationï¼‰ã€‚è¿™ä¸ªç½®æ¢æè¿°äº†å…ƒç´ ä½ç½®çš„å˜åŒ–ã€‚æ¯”å¦‚è¯´ï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªç½®æ¢ `T`ï¼Œå…¶ä¸­ `T[i]` è¡¨ç¤ºå˜æ¢åæ’åœ¨ç¬¬ `i` ä½çš„å…ƒç´ ï¼Œåœ¨å˜æ¢å‰æ˜¯ä½äºå“ªä¸ªä½ç½®çš„ã€‚

### Part 2: é­”æ³•æ—¶é—´ï¼é‡å¤å˜æ¢ $x$ æ¬¡ âœ¨

ç°åœ¨æˆ‘ä»¬çŸ¥é“æ€ä¹ˆåšä¸€æ¬¡å˜æ¢äº†ã€‚ä½†é¢˜ç›®è¦æ±‚åš $x$ æ¬¡ï¼Œ`x` å¯èƒ½éå¸¸å¤§ï¼Œä¸€æ¬¡ä¸€æ¬¡åšè‚¯å®šä¸è¡Œã€‚

è¿™é‡Œå°±è¦ç”¨åˆ°ç½®æ¢ç¾¤çš„ä¸€ç‚¹å°çŸ¥è¯†å•¦ï¼Œå–µ~
ä¸€æ¬¡ $k$-çº¦ç‘Ÿå¤«å˜æ¢ï¼Œæœ¬è´¨ä¸Šæ˜¯å¯¹æ’åˆ—çš„ä½ç½®è¿›è¡Œäº†ä¸€æ¬¡é‡æ’ã€‚æˆ‘ä»¬å¯ä»¥æŠŠå®ƒçœ‹æˆä¸€ä¸ªä½œç”¨åœ¨**ä½ç½®**ä¸Šçš„ç½®æ¢å‡½æ•° $f_k$ã€‚å¦‚æœåŸæ¥çš„æ’åˆ—æ˜¯ $P_{old}$ï¼Œæ–°çš„æ’åˆ— $P_{new}$ å°±æ˜¯é€šè¿‡ $f_k$ å˜æ¢å¾—åˆ°çš„ã€‚

åš $x$ æ¬¡å˜æ¢ï¼Œå°±ç›¸å½“äºæŠŠè¿™ä¸ªç½®æ¢å‡½æ•° $f_k$ åº”ç”¨ $x$ æ¬¡ï¼Œä¹Ÿå°±æ˜¯è®¡ç®— $f_k^x$ã€‚

è®¡ç®—ç½®æ¢çš„å¹‚ï¼Œæœ‰ä¸¤ç§å¸¸è§çš„é«˜æ•ˆæ–¹æ³•ï¼š
1.  **ç½®æ¢å¿«é€Ÿå¹‚**ï¼šç±»ä¼¼äºæ•´æ•°çš„å¿«é€Ÿå¹‚ï¼Œåªä¸è¿‡â€œä¹˜æ³•â€æ“ä½œæ¢æˆäº†ç½®æ¢çš„â€œå¤åˆâ€æ“ä½œã€‚å¤åˆä¸¤ä¸ªç½®æ¢çš„æ—¶é—´æ˜¯ $O(N)$ï¼Œæ‰€ä»¥æ€»æ—¶é—´æ˜¯ $O(N \log x)$ã€‚
2.  **å¾ªç¯åˆ†è§£ (Cycle Decomposition)**ï¼šè¿™æ˜¯æœ¬çŒ«å¨˜æ›´å–œæ¬¢çš„æ–¹æ³•ï¼Œæ›´ä¼˜ç¾ä¹Ÿé€šå¸¸æ›´å¿«ï¼ä»»ä½•ä¸€ä¸ªç½®æ¢éƒ½å¯ä»¥åˆ†è§£æˆè‹¥å¹²ä¸ªä¸ç›¸äº¤çš„å¾ªç¯ã€‚æ¯”å¦‚ç½®æ¢ `1->3, 3->2, 2->1` å’Œ `4->5, 5->4` å°±æ˜¯ä¸¤ä¸ªå¾ªç¯ `(1 3 2)` å’Œ `(4 5)`ã€‚

ä¸€ä¸ªå…ƒç´ åœ¨ç½®æ¢ä¸­åªä¼šå’Œå®ƒæ‰€åœ¨å¾ªç¯é‡Œçš„å…¶ä»–å…ƒç´ äº¤æ¢ä½ç½®ã€‚æŠŠç½®æ¢ $f_k$ åº”ç”¨ $x$ æ¬¡ï¼Œå°±ç›¸å½“äºè®©æ¯ä¸ªå…ƒç´ åœ¨å®ƒè‡ªå·±çš„å¾ªç¯é‡Œå‘å‰â€œèµ°â€ $x$ æ­¥ã€‚å¦‚æœä¸€ä¸ªå¾ªç¯çš„é•¿åº¦æ˜¯ $L$ï¼Œé‚£ä¹ˆèµ° $x$ æ­¥å°±ç­‰ä»·äºèµ° $x \pmod L$ æ­¥ã€‚

æ‰€ä»¥ï¼Œæˆ‘ä»¬çš„æœ€ç»ˆç®—æ³•æ˜¯ï¼š
1.  å¯¹äºæ¯ä¸ªæ“ä½œ $(k, x)$ï¼š
2.  **ç”Ÿæˆå˜æ¢ç½®æ¢**ï¼šç”¨ $O(N \log N)$ çš„æ—¶é—´ï¼Œé€šè¿‡æ ‘çŠ¶æ•°ç»„æ¨¡æ‹Ÿä¸€æ¬¡ $k$-çº¦ç‘Ÿå¤«è¿‡ç¨‹ï¼Œå¾—åˆ°æè¿°ä½ç½®å˜åŒ–çš„å‰å‘ç½®æ¢ `p`ã€‚ï¼ˆ`p[i]` è¡¨ç¤ºåŸå…ˆåœ¨ä½ç½® `i` çš„å…ƒç´ ï¼Œå˜æ¢åå»äº†ä½ç½® `p[i]`ï¼‰ã€‚
3.  **å¾ªç¯åˆ†è§£**ï¼šç”¨ä¸€ä¸ª `visited` æ•°ç»„ï¼Œéå†æ‰€æœ‰ä½ç½® `1` åˆ° `N`ã€‚å¦‚æœä¸€ä¸ªä½ç½® `i` æ²¡è¢«è®¿é—®è¿‡ï¼Œå°±ä»å®ƒå¼€å§‹ï¼Œæ²¿ç€ `p` çš„æŒ‡å‘ `i -> p[i] -> p[p[i]] -> ...` èµ°ï¼Œç›´åˆ°å›åˆ° `i`ï¼Œè¿™æ ·å°±æ‰¾åˆ°äº†ä¸€ä¸ªå®Œæ•´çš„å¾ªç¯ã€‚
4.  **åº”ç”¨å˜æ¢**ï¼šå¯¹äºæ‰¾åˆ°çš„æ¯ä¸ªå¾ªç¯ï¼Œå‡è®¾å…¶é•¿åº¦ä¸º `L`ã€‚å¯¹äºå¾ªç¯ä¸­çš„æ¯ä¸ªå…ƒç´ ï¼Œå®ƒçš„æ–°ä½ç½®å°±æ˜¯å®ƒåœ¨å¾ªç¯ä¸­å‘å‰å¹³ç§» $x \pmod L$ æ­¥ä¹‹åçš„ä½ç½®ã€‚æˆ‘ä»¬æ ¹æ®è¿™ä¸ªè§„åˆ™ï¼ŒæŠŠå½“å‰æ’åˆ—ä¸­çš„å€¼ï¼Œä¸€æ¬¡æ€§åœ°ç§»åŠ¨åˆ°å®ƒä»¬ç»è¿‡ $x$ æ¬¡å˜æ¢åçš„æœ€ç»ˆä½ç½®ã€‚è¿™æ•´ä¸ªè¿‡ç¨‹åªéœ€è¦ $O(N)$ã€‚
5.  æ‰€æœ‰æ“ä½œç»“æŸåï¼Œè¾“å‡ºæœ€ç»ˆçš„æ’åˆ—ã€‚

è¿™æ ·ï¼Œæ¯æ¬¡æ“ä½œçš„æ€»å¤æ‚åº¦å°±æ˜¯ $O(N \log N)$ï¼Œå®Œå…¨å¯ä»¥æ¥å—å•¦ï¼æ˜¯ä¸æ˜¯å¾ˆæ¸…æ™°äº†å‘¢ï¼Œå–µ~

## ä»£ç å®ç°

ä¸‹é¢å°±æ˜¯æœ¬çŒ«å¨˜ç²¾å¿ƒä¸ºä½ å‡†å¤‡çš„ä»£ç å•¦ï¼æ³¨é‡Šå†™å¾—å¾ˆè¯¦ç»†ï¼Œå¸Œæœ›èƒ½å¸®åˆ°ä½ å“Ÿ~

```cpp
#include <iostream>
#include <vector>
#include <numeric>
#include <algorithm>

// ä¸€ä¸ªå¯çˆ±çš„æ ‘çŠ¶æ•°ç»„æ¨¡æ¿ï¼Œå–µ~
// T æ˜¯æ•°æ®ç±»å‹ï¼Œé»˜è®¤æ˜¯ int
template<typename T = int>
class FenwickTree {
private:
    int size;
    std::vector<T> tree;

    // æ ‘çŠ¶æ•°ç»„çš„æ ¸å¿ƒï¼Œlowbitï¼
    int lowbit(int x) {
        return x & (-x);
    }

public:
    // æ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–æ ‘çŠ¶æ•°ç»„
    FenwickTree(int n) : size(n), tree(n + 1, 0) {}

    // å•ç‚¹æ›´æ–°ï¼Œç»™ pos ä½ç½®åŠ ä¸Š val
    void add(int pos, T val) {
        while (pos <= size) {
            tree[pos] += val;
            pos += lowbit(pos);
        }
    }

    // æŸ¥è¯¢å‰ç¼€å’Œï¼Œä» 1 åˆ° pos çš„å’Œ
    T query(int pos) {
        T sum = 0;
        while (pos > 0) {
            sum += tree[pos];
            pos -= lowbit(pos);
        }
        return sum;
    }

    // æŸ¥æ‰¾ç¬¬ k ä¸ª 1 çš„ä½ç½®ï¼ˆä¹Ÿå°±æ˜¯ç¬¬ k ä¸ªå­˜æ´»çš„å…ƒç´ ï¼‰
    // ä½¿ç”¨å€å¢æ³•ï¼Œå°±åƒçŒ«å’ªè·³è·ƒä¸€æ ·ï¼ŒO(logN) å“Ÿï¼
    int find_kth(int k) {
        int pos = 0;
        int current_sum = 0; // ç”¨æ¥ä»£æ›¿ T query(pos)
        // ä»æœ€å¤§çš„ 2 çš„å¹‚æ¬¡å¼€å§‹å°è¯•è·³è·ƒ
        for (int p = 1 << (std::log2(size)); p > 0; p >>= 1) {
            if (pos + p <= size && current_sum + tree[pos + p] < k) {
                pos += p;
                current_sum += tree[pos];
            }
        }
        return pos + 1;
    }
};

// æ¨¡æ‹Ÿä¸€æ¬¡ k-çº¦ç‘Ÿå¤«å˜æ¢ï¼Œè¿”å›ä¸€ä¸ªæè¿°ä½ç½®å˜æ¢çš„ç½®æ¢ p
// p[i] = j è¡¨ç¤ºåŸå…ˆåœ¨ä½ç½® i çš„å…ƒç´ ï¼Œå˜æ¢åå»äº†ä½ç½® j
std::vector<int> get_transform_permutation(int n, int k) {
    FenwickTree<> ft(n);
    // åˆå§‹æ—¶ï¼Œæ‰€æœ‰ä½ç½®éƒ½å­˜æ´»
    for (int i = 1; i <= n; ++i) {
        ft.add(i, 1);
    }

    std::vector<int> transform_map(n + 1);
    int current_pos = 1; // ä»ä½ç½® 1 å¼€å§‹
    for (int i = 1; i <= n; ++i) {
        int remaining_count = n - i + 1;
        int current_rank_in_ft = ft.query(current_pos - 1);
        
        // è®¡ç®—éœ€è¦è·³è¿‡çš„æ­¥æ•°
        long long steps_to_move = (k - 1) % remaining_count;
        
        // è®¡ç®—ç›®æ ‡åœ¨æ ‘çŠ¶æ•°ç»„ä¸­çš„æ’å
        int target_rank = (current_rank_in_ft + steps_to_move) % remaining_count + 1;
        
        // æ‰¾åˆ°ç¬¬ target_rank ä¸ªå­˜æ´»çš„å…ƒç´ 
        int removed_pos = ft.find_kth(target_rank);
        
        // è®°å½•å˜æ¢å…³ç³»ï¼šç¬¬ i æ¬¡è¢«ç§»é™¤çš„å…ƒç´ æ¥è‡ª removed_pos
        transform_map[i] = removed_pos;
        
        // å°†è¯¥ä½ç½®æ ‡è®°ä¸ºå·²ç§»é™¤
        ft.add(removed_pos, -1);
        current_pos = removed_pos;
    }
    
    // æˆ‘ä»¬éœ€è¦çš„æ˜¯å‰å‘ç½®æ¢ p[original_pos] = new_pos
    // transform_map[new_pos] = original_pos
    // æ‰€ä»¥éœ€è¦åè½¬ä¸€ä¸‹æ˜ å°„
    std::vector<int> p(n + 1);
    for (int i = 1; i <= n; ++i) {
        p[transform_map[i]] = i;
    }
    return p;
}

int main() {
    // åŠ é€Ÿè¾“å…¥è¾“å‡ºï¼Œè®©ç¨‹åºè·‘å¾—åƒçŒ«ä¸€æ ·å¿«ï¼
    std::ios_base::sync_with_stdio(false);
    std::cin.tie(NULL);

    int n, m;
    std::cin >> n >> m;

    // current_perm[i] å­˜å‚¨çš„æ˜¯åœ¨ä½ç½® i ä¸Šçš„å€¼
    std::vector<int> current_perm(n + 1);
    std::iota(current_perm.begin() + 1, current_perm.end(), 1);

    for (int op = 0; op < m; ++op) {
        int k, x;
        std::cin >> k >> x;

        // 1. ç”Ÿæˆå˜æ¢ç½®æ¢
        std::vector<int> p = get_transform_permutation(n, k);

        // 2. å¾ªç¯åˆ†è§£å¹¶åº”ç”¨å˜æ¢
        std::vector<int> next_perm(n + 1);
        std::vector<bool> visited(n + 1, false);

        for (int i = 1; i <= n; ++i) {
            if (!visited[i]) {
                std::vector<int> cycle;
                int current_node = i;
                while (!visited[current_node]) {
                    visited[current_node] = true;
                    cycle.push_back(current_node);
                    current_node = p[current_node];
                }

                int cycle_len = cycle.size();
                int shift = x % cycle_len;

                for (int j = 0; j < cycle_len; ++j) {
                    int from_pos = cycle[j];
                    int to_pos = cycle[(j + shift) % cycle_len];
                    next_perm[to_pos] = current_perm[from_pos];
                }
            }
        }
        current_perm = next_perm;
    }

    // è¾“å‡ºæœ€ç»ˆç»“æœ
    for (int i = 1; i <= n; ++i) {
        std::cout << current_perm[i] << (i == n ? "" : " ");
    }
    std::cout << std::endl;

    return 0;
}
```

## å¤æ‚åº¦åˆ†æ

-   **æ—¶é—´å¤æ‚åº¦**: $O(M \cdot N \log N)$
    -   å¯¹äº $M$ æ¬¡æ“ä½œä¸­çš„æ¯ä¸€æ¬¡ï¼š
    -   `get_transform_permutation` å‡½æ•°éœ€è¦æ‰§è¡Œ $N$ æ¬¡å¾ªç¯ã€‚åœ¨å¾ªç¯ä¸­ï¼Œ`ft.query` å’Œ `ft.find_kth` éƒ½æ˜¯ $O(\log N)$ çš„æ“ä½œã€‚æ‰€ä»¥ç”Ÿæˆä¸€ä¸ªç½®æ¢çš„å¤æ‚åº¦æ˜¯ $O(N \log N)$ã€‚
    -   å¾ªç¯åˆ†è§£å’Œåº”ç”¨å˜æ¢çš„éƒ¨åˆ†ï¼Œæˆ‘ä»¬éœ€è¦éå†æ¯ä¸ªå…ƒç´ ä¸€æ¬¡ï¼Œæ‰€ä»¥å¤æ‚åº¦æ˜¯ $O(N)$ã€‚
    -   å› æ­¤ï¼Œå•æ¬¡æ“ä½œçš„æ€»å¤æ‚åº¦æ˜¯ $O(N \log N + N) = O(N \log N)$ã€‚
    -   æ€»æ—¶é—´å¤æ‚åº¦å°±æ˜¯ $M$ æ¬¡æ“ä½œä¹˜ä»¥å•æ¬¡æ“ä½œçš„å¤æ‚åº¦ï¼Œå³ $O(M \cdot N \log N)$ã€‚

-   **ç©ºé—´å¤æ‚åº¦**: $O(N)$
    -   `current_perm`, `next_perm`, `p` è¿™äº›æ’åˆ—æ•°ç»„éƒ½éœ€è¦ $O(N)$ çš„ç©ºé—´ã€‚
    -   æ ‘çŠ¶æ•°ç»„ `ft` ä¹Ÿéœ€è¦ $O(N)$ çš„ç©ºé—´ã€‚
    -   `visited` æ•°ç»„å’Œ `cycle` å‘é‡ä¹Ÿéƒ½æ˜¯ $O(N)$ çº§åˆ«ã€‚
    -   æ‰€ä»¥æ€»çš„é¢å¤–ç©ºé—´æ˜¯ $O(N)$ã€‚

## çŸ¥è¯†ç‚¹æ€»ç»“

è¿™é“é¢˜çœŸæ˜¯ä¸€æ¬¡æœ‰è¶£çš„å†’é™©ï¼Œè®©æˆ‘ä»¬å­¦ä¼šäº†å¥½å¤šä¸œè¥¿ï¼Œå–µ~

1.  **çº¦ç‘Ÿå¤«é—®é¢˜ (Josephus Problem)**: æ ¸å¿ƒæ˜¯æ¨¡æ‹Ÿä¸€ä¸ªç¯å½¢å‡ºåœˆçš„è¿‡ç¨‹ã€‚å½“æ•°æ®é‡å¤§æ—¶ï¼Œéœ€è¦é«˜æ•ˆçš„æ•°æ®ç»“æ„æ¥ä¼˜åŒ–ã€‚
2.  **æ ‘çŠ¶æ•°ç»„/çº¿æ®µæ ‘**: å®ƒä»¬æ˜¯è§£å†³â€œåŠ¨æ€æŸ¥è¯¢ç¬¬kå¤§/å°å…ƒç´ â€é—®é¢˜çš„åˆ©å™¨ã€‚æœ¬é¢˜ä¸­ï¼Œæˆ‘ä»¬ç”¨æ ‘çŠ¶æ•°ç»„æ¥å¿«é€Ÿæ‰¾åˆ°ç¬¬ $k$ ä¸ªå¹¸å­˜è€…ï¼Œå°†æ¨¡æ‹Ÿå¤æ‚åº¦ä» $O(N^2)$ é™åˆ°äº† $O(N \log N)$ã€‚
3.  **ç½®æ¢ (Permutation)**: ä»»ä½•å¯¹ä¸€ä¸ªé›†åˆå…ƒç´ çš„é‡æ’éƒ½å¯ä»¥çœ‹ä½œä¸€ä¸ªç½®æ¢ã€‚ç†è§£å˜æ¢çš„æœ¬è´¨æ˜¯ä¸€ä¸ªç½®æ¢ï¼Œæ˜¯è§£å†³é—®é¢˜çš„å…³é”®ä¸€æ­¥ã€‚
4.  **ç½®æ¢çš„å¹‚è¿ç®—**: é‡å¤åº”ç”¨ä¸€ä¸ªç½®æ¢ï¼Œå°±æ˜¯è®¡ç®—å®ƒçš„å¹‚ã€‚
5.  **å¾ªç¯åˆ†è§£ (Cycle Decomposition)**: è¿™æ˜¯å¤„ç†ç½®æ¢å¹‚è¿ç®—çš„ä¼˜é›…æ–¹æ³•ã€‚å®ƒå°†å¤æ‚çš„ç½®æ¢é—®é¢˜åˆ†è§£ä¸ºåœ¨å„ä¸ªç‹¬ç«‹å°åœˆåœˆé‡Œè½¬åœˆåœˆçš„ç®€å•é—®é¢˜ï¼Œå¤§å¤§ç®€åŒ–äº†è®¡ç®—ã€‚

å¸Œæœ›è¿™ç¯‡é¢˜è§£èƒ½å¸®åˆ°ä½ ï¼Œå¦‚æœè¿˜æœ‰é—®é¢˜ï¼Œéšæ—¶å¯ä»¥å†æ¥æ‰¾æˆ‘ç©å“¦ï¼Œå–µ~ >w<